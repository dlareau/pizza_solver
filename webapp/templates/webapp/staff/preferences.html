{% extends "webapp/base.html" %}
{% block title %}Group Preferences{% endblock %}

{% block extra_head %}
<style>
  .tag.is-danger.is-default  { background-color: transparent !important; color: black; border: 2.5px solid var(--bulma-danger); }
  .tag.is-warning.is-default { background-color: transparent !important; color: black; border: 2.5px solid var(--bulma-warning); }
  .tag.is-info.is-default    { background-color: transparent !important; color: black; border: 2.5px solid var(--bulma-info); }
  .tag.is-success.is-default { background-color: transparent !important; color: black; border: 2.5px solid var(--bulma-success); }
</style>
{% endblock %}

{% block content %}
<div class="level mb-4">
  <div class="level-left">
    <h1 class="title level-item">Group Preferences</h1>
  </div>
</div>

<form method="get" action="" class="mb-5" style="max-width: 480px;">
  <div class="field has-addons">
    <div class="control is-expanded">
      <div class="select is-fullwidth">
        <select name="group">
          <option value="">-- Select a group --</option>
          {% for group in all_groups %}
          <option value="{{ group.pk }}"
            {% if selected_group and group.pk == selected_group.pk %}selected{% endif %}>
            {{ group.name }}
          </option>
          {% endfor %}
        </select>
      </div>
    </div>
    <div class="control">
      <button class="button is-primary" type="submit">View</button>
    </div>
  </div>
</form>

{% if selected_group %}
  {% if not members %}
  <div class="notification is-warning is-default">
    <strong>{{ selected_group.name }}</strong> has no persistent members.
  </div>

  {% elif not toppings %}
  <div class="notification is-warning is-default">
    No toppings exist in the system yet.
  </div>

  {% else %}
  <p class="mb-3">
    <strong>{{ selected_group.name }}</strong> &mdash;
    {{ members|length }} member{{ members|length|pluralize }},
    {{ toppings|length }} topping{{ toppings|length|pluralize }}
  </p>

  <div class="is-flex mb-1" style="gap: 1.5rem; flex-wrap: wrap; align-items: center;">
    <span class="is-size-7 has-text-grey">Explicit:</span>
    <div class="tags mb-0">
      <span class="tag is-danger">Allergy</span>
      <span class="tag is-warning">Dislike</span>
      <span class="tag is-info">Neutral</span>
      <span class="tag is-success">Like</span>
    </div>
    <span class="is-size-7 has-text-grey">Default:</span>
    <div class="tags mb-0">
      <span class="tag is-warning is-default">Dislike</span>
      <span class="tag is-info is-default">Neutral</span>
    </div>
  </div>
  <p class="help mb-4">* = defaults unset preferences to Dislike.</p>

  <div style="overflow-x: auto;">
    <table class="table is-bordered is-striped is-hoverable" style="white-space: nowrap;">
      <thead>
        <tr>
          <th style="min-width: 140px;">Topping</th>
          {% for member in members %}
          <th style="min-width: 100px;">
            {{ member.name }}{% if member.unrated_is_dislike %} *{% endif %}
          </th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for row in matrix %}
        <tr>
          <td><strong>{{ row.topping.name }}</strong></td>
          {% for cell in row.cells %}
          <td class="has-text-centered">
            {% if cell.label == 'allergy' %}
            <span class="tag is-danger{% if cell.is_default %} is-default{% endif %}">Allergy</span>
            {% elif cell.label == 'dislike' %}
            <span class="tag is-warning{% if cell.is_default %} is-default{% endif %}">Dislike</span>
            {% elif cell.label == 'neutral' %}
            <span class="tag is-info{% if cell.is_default %} is-default{% endif %}">Neutral</span>
            {% elif cell.label == 'like' %}
            <span class="tag is-success{% if cell.is_default %} is-default{% endif %}">Like</span>
            {% endif %}
          </td>
          {% endfor %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
{% endif %}
{% endblock %}
