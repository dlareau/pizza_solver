{% extends "webapp/base.html" %}
{% block title %}{{ order.num_pizzas }} Pizza{{ order.num_pizzas|pluralize }} from {{ order.vendor }}{% endblock %}

{% block content %}

<h1 class="title mb-1">{{ order.num_pizzas }} Pizza{{ order.num_pizzas|pluralize }} from {{ order.vendor }}</h1>

<div class="tags are-medium mb-5">
  <span class="tag"><strong>Vendor:</strong>&nbsp;{{ order.vendor }}</span>
  <span class="tag"><strong>Host:</strong>&nbsp;{{ order.host }}</span>
  <span class="tag"><strong>Pizzas:</strong>&nbsp;{{ order.num_pizzas }}</span>
  <span class="tag"><strong>People:</strong>&nbsp;{{ order.people.count }}</span>
  <span class="tag"><strong>Mode:</strong>&nbsp;{{ order.get_optimization_mode_display }}</span>
</div>

{% if pizzas %}

<p class="heading mb-2">All participants</p>
<div class="tags are-medium mb-5">
  {% for person in order.people.all %}
    {% if person.pk in guest_person_ids %}
      <span class="tag is-light has-text-weight-semibold">{{ person }} <em class="ml-1 has-text-grey">guest</em></span>
    {% else %}
      <span class="tag has-text-weight-semibold">{{ person }}</span>
    {% endif %}
  {% endfor %}
</div>

<p class="heading mb-3">Pizza assignments</p>
<div class="columns is-multiline">
  {% for pizza in pizzas %}
  <div class="column is-half-tablet is-one-third-desktop">
    <div class="card">
      <div class="card-header">
        <p class="card-header-title">
          Pizza #{{ forloop.counter }}
          <span class="tag is-light ml-3">{{ pizza.toppings.count }} topping{{ pizza.toppings.count|pluralize }} · {{ pizza.people.count }} person{{ pizza.people.count|pluralize }}</span>
        </p>
      </div>
      <div class="card-content">
        <p class="heading mb-2">Toppings</p>
        <div class="tags are-medium mb-4">
          {% for t in pizza.toppings.all %}
            <span class="tag is-warning has-text-weight-semibold">{{ t }}</span>
          {% empty %}
            <em class="has-text-grey-light">Plain — no toppings</em>
          {% endfor %}
        </div>

        <p class="heading mb-2">People</p>
        <div class="tags are-medium">
          {% for person in pizza.people.all %}
            {% if person.pk in guest_person_ids %}
              <span class="tag is-light has-text-weight-semibold">{{ person }} <em class="ml-1 has-text-grey">guest</em></span>
            {% else %}
              <span class="tag has-text-weight-semibold">{{ person }}</span>
            {% endif %}
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

{% else %}
<div class="notification is-light">
  <p>No pizza assignments have been generated yet.</p>
</div>
{% endif %}

<a class="button is-light mt-2" href="{% url 'create_order' %}">← Create another order</a>

{% endblock %}
